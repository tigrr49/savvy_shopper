<div class="page-header">
  <h1>
    Items On Sale and Where
  </h1>
</div>

<div class="row">
  <div class="col-md-12">
    <table class="table table-striped table-hover">
      <tr>
        <th>Category</th>
        <th>Item</th>
        <th>Brand</th>
        <th>Size</th>
        <th>Unit</th>
        <th>Average Price</th>
        <th>Sale Price</th>
        <th>Store</th>
        <th>Actions</th>
      </tr>

      <% @items_on_sale_by_price_entry.each do |price_entry| %>
        <% item = price_entry.item %>
        <% item_average_price = item.price_entries.pluck(:price).uniq.sum / item.price_entries.pluck(:price).uniq.count %>
        <tr>
          <td><%= price_entry.category.name %></td>
          <td><%= price_entry.item.name %></td>
          <td><%= price_entry.item.brand %></td>
          <td><%= price_entry.item.size %></td>
          <td><%= price_entry.unit.name %></td>
          <td><%= number_to_currency(item_average_price) %></td>
          <td><%= number_to_currency(price_entry.price) %></td>
          <td><%= price_entry.store.name %></td>
          <td>
              <div class="btn-group-vertical btn-group-sm">
                <a href="/create_shopping_list_item/<%= price_entry.id %>" class="btn btn-primary">Add to My Shopping List</a>
                <a href="/items/<%= price_entry.item.id %>" class="btn btn-warning">View Details</a>
              </div>
            </div>
          </td>
        </tr>
      <% end %>
    </table>
  </div>
</div>
